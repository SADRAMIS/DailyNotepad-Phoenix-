<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .ai-buttons {
            margin-top: 0.5rem;
        }
        .ai-button {
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .loading {
            display: none;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É</h2>

    <form method="post" action="/notes">
        <div class="mb-3">
            <label for="title" class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
            <div class="input-group">
                <input type="text" class="form-control" id="title" name="title" required>
                <button type="button" class="btn btn-outline-info ai-button" onclick="generateTitle()">
                    ü§ñ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫
                </button>
            </div>
            <div class="ai-buttons">
                <button type="button" class="btn btn-sm btn-outline-primary ai-button" onclick="generateIdeas()">
                    üí° –ò–¥–µ–∏ –¥–ª—è –∑–∞–º–µ—Ç–∫–∏
                </button>
            </div>
        </div>

        <div class="mb-3">
            <label for="content" class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:</label>
            <textarea class="form-control" id="content" name="content" rows="5" required></textarea>
            <div class="ai-buttons">
                <button type="button" class="btn btn-sm btn-outline-success ai-button" onclick="autocompleteText()">
                    ‚úçÔ∏è –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
                </button>
                <button type="button" class="btn btn-sm btn-outline-warning ai-button" onclick="improveText()">
                    ‚ú® –£–ª—É—á—à–∏—Ç—å —Ç–µ–∫—Å—Ç
                </button>
                <button type="button" class="btn btn-sm btn-outline-info ai-button" onclick="generateTasks()">
                    üìã –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏
                </button>
            </div>
        </div>

        <div id="aiLoading" class="loading alert alert-info">
            <span class="spinner-border spinner-border-sm" role="status"></span>
            AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å...
        </div>

        <div id="aiResult" class="alert alert-success" style="display: none;"></div>
        <div id="aiError" class="alert alert-danger" style="display: none;"></div>

        <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
        <a href="/" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    function showLoading() {
        document.getElementById('aiLoading').style.display = 'block';
        document.getElementById('aiResult').style.display = 'none';
        document.getElementById('aiError').style.display = 'none';
    }

    function hideLoading() {
        document.getElementById('aiLoading').style.display = 'none';
    }

    function showResult(text) {
        hideLoading();
        document.getElementById('aiResult').style.display = 'block';
        document.getElementById('aiResult').textContent = text;
        document.getElementById('aiError').style.display = 'none';
    }

    function showError(error) {
        hideLoading();
        document.getElementById('aiError').style.display = 'block';
        document.getElementById('aiError').textContent = '–û—à–∏–±–∫–∞: ' + error;
        document.getElementById('aiResult').style.display = 'none';
    }

    async function callAI(endpoint, prompt) {
        showLoading();
        try {
            const response = await fetch('/api/ai/' + endpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ prompt: prompt })
            });
            const data = await response.json();
            if (data.success) {
                return data.content;
            } else {
                throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
            }
        } catch (error) {
            showError(error.message);
            throw error;
        }
    }

    async function generateTitle() {
        const content = document.getElementById('content').value;
        if (!content.trim()) {
            showError('–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞');
            return;
        }
        try {
            const title = await callAI('title', content);
            document.getElementById('title').value = title;
            showResult('–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ –≤—Å—Ç–∞–≤–ª–µ–Ω!');
        } catch (error) {
            // –û—à–∏–±–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤ callAI
        }
    }

    async function generateIdeas() {
        const title = document.getElementById('title').value || '–∑–∞–º–µ—Ç–∫–∞';
        try {
            const ideas = await callAI('ideas', title);
            showResult('–ò–¥–µ–∏ –¥–ª—è –∑–∞–º–µ—Ç–∫–∏:\n' + ideas);
        } catch (error) {
            // –û—à–∏–±–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤ callAI
        }
    }

    async function autocompleteText() {
        const content = document.getElementById('content').value;
        if (!content.trim()) {
            showError('–í–≤–µ–¥–∏—Ç–µ –Ω–∞—á–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è');
            return;
        }
        try {
            const completed = await callAI('autocomplete', content);
            document.getElementById('content').value = content + ' ' + completed;
            showResult('–¢–µ–∫—Å—Ç –¥–æ–ø–æ–ª–Ω–µ–Ω!');
        } catch (error) {
            // –û—à–∏–±–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤ callAI
        }
    }

    async function improveText() {
        const content = document.getElementById('content').value;
        if (!content.trim()) {
            showError('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è');
            return;
        }
        try {
            const improved = await callAI('improve', content);
            document.getElementById('content').value = improved;
            showResult('–¢–µ–∫—Å—Ç —É–ª—É—á—à–µ–Ω!');
        } catch (error) {
            // –û—à–∏–±–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤ callAI
        }
    }

    async function generateTasks() {
        const content = document.getElementById('content').value;
        if (!content.trim()) {
            showError('–í–≤–µ–¥–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–¥–∞—á');
            return;
        }
        try {
            const tasks = await callAI('tasks', content);
            showResult('–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:\n' + tasks);
        } catch (error) {
            // –û—à–∏–±–∫–∞ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –≤ callAI
        }
    }
</script>
</body>
</html>